<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-2.2.4.js"></script>
</head>
<body>
<div>
    <button onclick="log()">在console显示数据</button>
    <button onclick="join()">上线</button>
    <button onclick="leave()">断开</button>
    <button onclick="broadcast()">广播</button>
    <button onclick="multicast()">组播</button>
    <button onclick="send()">单播</button>
    <button onclick="info()">NodeInfo</button>
    <button onclick="nodes()">NodeList</button>
</div>
NodeIDs:<textarea id="tos"></textarea>
content:<textarea id="body"></textarea>
<div id="info"></div>
<div id="list"></div>
</body>
<script>
    function log() {
        let socket = new WebSocket("ws://" + window.location.host + "/log");
        socket.onopen = function (e) {
            console.log(e)
        };
        socket.onmessage = function (event) {
            console.log(event.data)
        };
    }

    function data() {
        let body = $("#body").val();
        let tos = $("#tos").val();
        return {body: body, tos: tos}
    }

    function join() {
        $.post("join", function (data) {
            alert(data)
        })
    }

    function leave() {
        $.post("leave", function (data) {
            alert(data)
        })
    }

    function multicast() {
        $.post("multicast", data(), function (data) {
            alert(data)
        })
    }

    function broadcast() {
        $.post("broadcast", data(), function (data) {
            alert(data)
        })
    }

    function send() {
        $.post("send", data(), function (data) {
            alert(data)
        })
    }

    function nodes() {
        $.post("nodes", function (data) {
            text = "<table border='1'><tr><th>NodeID</th><th>addr</th><th>type</th></tr>"
            for (i in data) {
                console.log(data[i])
                text = text + "<tr>" +
                    "<td>" + data[i].id + "</td>" +
                    "<td>" + data[i].addr + "</td>" +
                    "<td>" + data[i].type + "</td>" +
                    "</tr>"
            }

            $("#list").html(text)
        })
    }

    function info() {
        $.post("info", function (data) {
            text = "<p>id:" + data.id + "</p>"
            for (i in data.ip) {
                text = text + data.ip[i] + ";&nbsp;"
            }
            text = text + "<p>dis:" + data.dis + "</p>"
            text = text + "<p>ser:" + data.ser + "</p>"
            $("#info").html(text)
        })
    }
</script>
</html>